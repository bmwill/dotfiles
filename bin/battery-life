#!/bin/bash
# modified from http://ficate.com/blog/2012/10/15/battery-life-in-the-land-of-tmux/

HEART='♥ '
NUM_HEARTS=4

if [[ `uname` == 'Linux' ]]; then
  if [ ! -d "/proc/acpi/battery" ]; then
    # Machine doesn't have a battery
    exit
  fi
  current_charge=$(cat /proc/acpi/battery/BAT1/state | grep 'remaining capacity' | awk '{print $3}')
  total_charge=$(cat /proc/acpi/battery/BAT1/info | grep 'last full capacity' | awk '{print $4}')
else
  #pmset -g batt
  battery_info=`ioreg -rc AppleSmartBattery`
  current_charge=$(echo $battery_info | grep -o '"CurrentCapacity" = [0-9]\+' | awk '{print $3}')
  total_charge=$(echo $battery_info | grep -o '"MaxCapacity" = [0-9]\+' | awk '{print $3}')
fi

charged_slots=$(echo "((($current_charge/$total_charge)*$NUM_HEARTS))+1" | bc -l | cut -d '.' -f 1)
if [[ $charged_slots -gt $NUM_HEARTS ]]; then
  charged_slots=$NUM_HEARTS
fi

echo -n '#[fg=colour196]'
for i in `seq 1 $charged_slots`; do echo -n "$HEART"; done

if [[ $charged_slots -lt $NUM_HEARTS ]]; then
  echo -n '#[fg=colour254]'
  for i in `seq 1 $(echo "$NUM_HEARTS-$charged_slots" | bc)`; do echo -n "$HEART"; done
fi

#HEART='❤'
#
#battery_info=`pmset -g batt`
#current_charge=$(echo $battery_info | grep -o '[0-9]\+%' | awk '{sub (/%/, "", $1); print $1}')
#
#if [[ $current_charge -lt 30 ]]; then
#    echo -n '#[fg=colour41]'
#elif [[ $current_charge -lt 50 ]]; then
#    echo -n '#[fg=colour42]'
#elif [[ $current_charge -lt 70 ]]; then
#    echo -n '#[fg=colour43]'
#elif [[ $current_charge -lt 90 ]]; then
#    echo -n '#[fg=colour44]'
#else
#    echo -n '#[fg=colour45]'
#fi
#
#echo -n "$HEART $current_charge%"
